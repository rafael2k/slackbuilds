diff -Naur imlib2-1.4.2.orig/src/modules/loaders/loader_xpm.c imlib2-1.4.2/src/modules/loaders/loader_xpm.c
--- imlib2-1.4.2.orig/src/modules/loaders/loader_xpm.c	2008-10-21 00:32:51.000000000 -0200
+++ imlib2-1.4.2/src/modules/loaders/loader_xpm.c	2009-04-25 13:31:35.000000000 -0300
@@ -253,7 +253,7 @@
                                  return 0;
                               }
                             ptr = im->data;
-                            end = ptr + (sizeof(DATA32) * w * h);
+                            end = ptr + (pixels);
                             pixels = w * h;
                          }
                        else
